<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Análisis Agro-Climático</title>
    <script src="chart.js"></script>
    <style>
        body { font-family: sans-serif; margin: 20px; background-color: #f0f4f8; }
        .box { max-width: 800px; margin: auto; background: white; padding: 20px; border-radius: 10px; border: 1px solid #d1d9e0; }
        h1 { color: #1a5f7a; text-align: center; }
        #error-log { color: #a94442; background: #f2dede; padding: 10px; border-radius: 5px; display: none; margin-bottom: 20px; border: 1px solid #ebccd1; }
    </style>
</head>
<body>
    <div class="box">
        <h1>Lluvia Mensual - Estación Chinchilla</h1>
        <div id="error-log"></div>
        <canvas id="grafica"></canvas>
    </div>

    <script>
        const log = document.getElementById('error-log');

        // Función para mostrar errores en pantalla
        function mostrarError(txt) {
            log.style.display = 'block';
            log.innerHTML += `<p>⚠️ ${txt}</p>`;
        }

        // 1. Verificar si la librería Chart.js se ha cargado
        if (typeof Chart === 'undefined') {
            mostrarError("La librería 'chart.js' no se ha cargado. Verifica que subiste el archivo 'chart.js' a GitHub.");
        }

        // 2. Cargar los datos
        fetch('datos_clima.json')
            .then(res => {
                if(!res.ok) throw new Error("No encuentro el archivo 'datos_clima.json'.");
                return res.json();
            })
            .then(datos => {
                const meses = {};
                datos.forEach(d => {
                    const m = d.fecha.substring(0, 7);
                    // Convertimos la coma en punto para que el ordenador sepa sumar
                    const lluvia = parseFloat(d.prec.replace(',', '.')) || 0;
                    meses[m] = (meses[m] || 0) + lluvia;
                });

                new Chart(document.getElementById('grafica'), {
                    type: 'bar',
                    data: {
                        labels: Object.keys(meses),
                        datasets: [{
                            label: 'Lluvia Total (mm)',
                            data: Object.values(meses).map(v => v.toFixed(1)),
                            backgroundColor: '#3498db'
                        }]
                    }
                });
            })
            .catch(err => mostrarError(err.message));
    </script>
</body>
</html>
