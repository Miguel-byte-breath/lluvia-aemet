<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Dashboard Agronómico - Chinchilla</title>
    <script src="chart.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; margin: 30px; background-color: #f8fafc; color: #1e293b; }
        .container { max-width: 900px; margin: auto; background: white; padding: 25px; border-radius: 15px; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); }
        h1 { color: #0f172a; text-align: center; border-bottom: 2px solid #3b82f6; padding-bottom: 10px; }
        #error-display { color: #991b1b; background: #fef2f2; padding: 10px; border-radius: 6px; display: none; margin: 15px 0; border: 1px solid #fecaca; text-align: center; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Análisis de Precipitación Mensual</h1>
        <div id="error-display"></div>
        <div style="height: 400px; margin-top: 20px;">
            <canvas id="graficaLluvia"></canvas>
        </div>
    </div>

    <script>
        const errorDiv = document.getElementById('error-display');

        // Comprobación de que la librería está cargada
        if (typeof Chart === 'undefined') {
            errorDiv.style.display = 'block';
            errorDiv.innerText = "⚠️ Error: La pieza 'chart.js' no se ha cargado correctamente en el navegador.";
        }

        fetch('datos_clima.json')
            .then(res => {
                if(!res.ok) throw new Error("No encuentro el archivo 'datos_clima.json'. Revisa el nombre.");
                return res.json();
            })
            .then(datos => {
                const meses = {};
                datos.forEach(d => {
                    const mes = d.fecha.substring(0, 7);
                    const lluvia = parseFloat(d.prec.replace(',', '.')) || 0;
                    meses[mes] = (meses[mes] || 0) + lluvia;
                });

                new Chart(document.getElementById('graficaLluvia'), {
                    type: 'bar',
                    data: {
                        labels: Object.keys(meses),
                        datasets: [{
                            label: 'Lluvia acumulada (mm)',
                            data: Object.values(meses).map(v => v.toFixed(1)),
                            backgroundColor: '#3b82f6'
                        }]
                    },
                    options: { responsive: true, maintainAspectRatio: false }
                });
            })
            .catch(err => {
                errorDiv.style.display = 'block';
                errorDiv.innerText = "⚠️ Error: " + err.message;
            });
    </script>
</body>
</html>
